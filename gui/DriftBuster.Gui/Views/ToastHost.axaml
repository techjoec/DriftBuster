<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="using:DriftBuster.Gui.Converters"
             xmlns:services="using:DriftBuster.Gui.Services"
             x:Class="DriftBuster.Gui.Views.ToastHost"
             x:DataType="services:IToastService">
  <UserControl.Resources>
    <DataTemplate x:Key="ToastCardTemplate"
                  x:DataType="services:ToastNotification">
      <Border Classes="toast-card"
              Background="{Binding Level, Converter={x:Static conv:ToastLevelToBrushConverter.Instance}}">
        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="12">
          <TextBlock Text="{Binding Level, Converter={x:Static conv:ToastLevelToIconConverter.Instance}}"
                     FontSize="{DynamicResource Toast.IconFontSize}"
                     VerticalAlignment="Center"
                     Foreground="{DynamicResource Brush.Toast.Foreground}" />
          <StackPanel Grid.Column="1" Spacing="{DynamicResource Toast.InnerSpacing}">
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
              <TextBlock Text="{Binding Title}"
                         FontWeight="SemiBold"
                         FontSize="15"
                         Foreground="{DynamicResource Brush.Toast.Foreground}" />
              <TextBlock Grid.Column="1"
                         Text="{Binding TimestampText}"
                         FontSize="11"
                         Foreground="{DynamicResource Brush.Toast.Timestamp}"
                         HorizontalAlignment="Right" />
            </Grid>
            <TextBlock Text="{Binding Message}"
                       TextWrapping="Wrap"
                       Foreground="{DynamicResource Brush.Toast.Foreground}" />
            <StackPanel Orientation="Horizontal"
                        Spacing="8"
                        HorizontalAlignment="Right">
              <Button Content="{Binding SecondaryLabel}"
                      Classes="outline"
                      Command="{Binding SecondaryCommand}"
                      IsVisible="{Binding SecondaryCommand}"
                      Foreground="{DynamicResource Brush.Toast.Foreground}"
                      Background="Transparent" />
              <Button Content="{Binding PrimaryLabel}"
                      Classes="outline"
                      Command="{Binding PrimaryCommand}"
                      IsVisible="{Binding PrimaryCommand}"
                      Foreground="{DynamicResource Brush.Toast.Foreground}"
                      Background="Transparent" />
              <Button Content="Dismiss"
                      Classes="outline"
                      Command="{Binding DismissCommand}"
                      Foreground="{DynamicResource Brush.Toast.Foreground}"
                      Background="Transparent" />
            </StackPanel>
          </StackPanel>
        </Grid>
      </Border>
    </DataTemplate>
  </UserControl.Resources>

  <StackPanel Orientation="Vertical"
              Spacing="{DynamicResource Toast.StackSpacing}"
              HorizontalAlignment="Right"
              VerticalAlignment="Top"
              Margin="{DynamicResource Toast.HostMargin}">
    <ItemsControl ItemsSource="{Binding ActiveToasts}"
                  ItemTemplate="{StaticResource ToastCardTemplate}"
                  HorizontalAlignment="Right">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <StackPanel Spacing="8" />
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
    </ItemsControl>

    <Expander Margin="0,8,0,0"
              Width="{DynamicResource Toast.Width}"
              HorizontalAlignment="Right"
              IsVisible="{Binding OverflowToasts.Count, Converter={x:Static conv:CountToBooleanConverter.Instance}}">
      <Expander.Header>
          <StackPanel Orientation="Horizontal" Spacing="6">
          <TextBlock Text="More alerts"
                     Foreground="{DynamicResource Brush.Toast.OverflowHeader}" />
          <TextBlock Text="{Binding OverflowToasts.Count, StringFormat='({0})'}"
                     Foreground="{DynamicResource Brush.Toast.OverflowHeader}" />
        </StackPanel>
      </Expander.Header>
      <ItemsControl ItemsSource="{Binding OverflowToasts}"
                    ItemTemplate="{StaticResource ToastCardTemplate}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <StackPanel Spacing="8" />
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
      </ItemsControl>
    </Expander>
  </StackPanel>
</UserControl>
